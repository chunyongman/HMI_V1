# 네트워크를 통한 HMI 배포 가이드

## 개요

네트워크 공유 폴더를 **배포 저장소**로 활용하여 여러 PC에 HMI 시스템을 배포하는 방법입니다.

**핵심 원칙:**
- ✅ 네트워크는 배포용 저장소로만 사용
- ✅ 실행은 항상 로컬 PC에서
- ✅ 중앙에서 버전 관리

---

## 1단계: 네트워크 배포 저장소 설정

### 폴더 구조 생성

```
\\192.168.0.250\HMI_배포\
├── 00_최신버전\
│   └── HMI_REAL\
├── 01_이전버전\
│   ├── HMI_REAL_2025-01-18\
│   ├── HMI_REAL_2025-01-11\
│   └── HMI_REAL_2025-01-04\
├── 설치_가이드.txt
└── Docker_Desktop_설치.txt
```

### 설치 가이드 작성

**설치_가이드.txt:**
```
HMI 시스템 설치 방법

1. Docker Desktop 설치 (최초 1회만)
   - 파일: Docker Desktop Installer.exe
   - 또는 https://www.docker.com/products/docker-desktop
   - 설치 후 재부팅

2. HMI 프로그램 복사
   - 위치: \\192.168.0.250\HMI_배포\00_최신버전\HMI_REAL
   - 복사 대상: C:\HMI_REAL

3. 실행
   - C:\HMI_REAL\START_DOCKER.bat 더블클릭
   - 처음: 10분 소요
   - 이후: 10초 이내

4. 접속
   - 자동으로 브라우저 실행
   - http://localhost:5173

문의: IT팀 내선 1234
```

---

## 2단계: 개발자 PC에서 배포 준비

### 자동 배포 스크립트 생성

**DEPLOY_TO_NETWORK.bat:**
```batch
@echo off
chcp 65001 >nul
cd /d "%~dp0"

echo ============================================================
echo    네트워크 배포 저장소로 업로드
echo ============================================================
echo.

REM 네트워크 경로 설정
set "NETWORK_PATH=\\192.168.0.250\HMI_배포"
set "TARGET_FOLDER=%NETWORK_PATH%\00_최신버전\HMI_REAL"
set "BACKUP_FOLDER=%NETWORK_PATH%\01_이전버전\HMI_REAL_%date:~0,4%%date:~5,2%%date:~8,2%_%time:~0,2%%time:~3,2%"

REM 네트워크 접근 확인
if not exist "%NETWORK_PATH%" (
    echo [오류] 네트워크 경로에 접근할 수 없습니다.
    echo        경로: %NETWORK_PATH%
    echo.
    echo [확인사항]
    echo    - 네트워크 연결 확인
    echo    - 공유 폴더 권한 확인
    echo    - VPN 연결 확인
    pause
    exit /b 1
)

echo [1/4] 배포용 파일 준비 중...
if exist "USB_DEPLOY" (
    rmdir /s /q "USB_DEPLOY"
)
call PREPARE_USB.bat
echo.

echo [2/4] 기존 버전 백업 중...
if exist "%TARGET_FOLDER%" (
    echo     기존 최신버전을 백업합니다...
    xcopy "%TARGET_FOLDER%" "%BACKUP_FOLDER%\" /E /I /Q /Y >nul
    echo     ✓ 백업 완료: %BACKUP_FOLDER%
)
echo.

echo [3/4] 최신 버전 업로드 중...
if exist "%TARGET_FOLDER%" (
    rmdir /s /q "%TARGET_FOLDER%"
)
xcopy "USB_DEPLOY" "%TARGET_FOLDER%\" /E /I /Q /Y
echo     ✓ 업로드 완료
echo.

echo [4/4] 변경 이력 기록 중...
echo 배포 일시: %date% %time% > "%TARGET_FOLDER%\배포_정보.txt"
echo 배포자: %USERNAME% >> "%TARGET_FOLDER%\배포_정보.txt"
echo 컴퓨터: %COMPUTERNAME% >> "%TARGET_FOLDER%\배포_정보.txt"
echo ✓ 완료
echo.

echo ============================================================
echo    ✓ 네트워크 배포 완료!
echo ============================================================
echo.
echo [배포 정보]
echo    - 최신버전: %TARGET_FOLDER%
echo    - 백업: %BACKUP_FOLDER%
echo.
echo [사용자 안내]
echo    각 PC에서:
echo    1. %TARGET_FOLDER% 를
echo    2. C:\HMI_REAL 로 복사
echo    3. C:\HMI_REAL\START_DOCKER.bat 실행
echo.
pause
```

---

## 3단계: 사용자 PC에서 설치

### 자동 설치 스크립트 (네트워크 공유)

**INSTALL_FROM_NETWORK.bat:** (네트워크에 배치)
```batch
@echo off
chcp 65001 >nul

echo ============================================================
echo    HMI 시스템 설치 (네트워크에서)
echo ============================================================
echo.

REM 네트워크 경로
set "NETWORK_PATH=\\192.168.0.250\HMI_배포\00_최신버전\HMI_REAL"
set "LOCAL_PATH=C:\HMI_REAL"

echo [안내]
echo    이 스크립트는 네트워크에서 HMI 시스템을 설치합니다.
echo.
echo    복사 원본: %NETWORK_PATH%
echo    설치 위치: %LOCAL_PATH%
echo.

REM 네트워크 접근 확인
if not exist "%NETWORK_PATH%" (
    echo [오류] 네트워크 경로를 찾을 수 없습니다.
    echo        %NETWORK_PATH%
    pause
    exit /b 1
)

REM 기존 설치 확인
if exist "%LOCAL_PATH%" (
    echo [경고] 기존 설치를 발견했습니다.
    echo.
    choice /c YN /m "기존 설치를 덮어쓰시겠습니까? (Y/N)"
    if errorlevel 2 goto :cancel
    if errorlevel 1 (
        echo.
        echo 기존 설치 제거 중...
        rmdir /s /q "%LOCAL_PATH%"
        echo ✓ 제거 완료
    )
)

echo.
echo [1/3] 파일 복사 중... (약 1~2분 소요)
xcopy "%NETWORK_PATH%" "%LOCAL_PATH%\" /E /I /Q /Y
echo     ✓ 복사 완료
echo.

echo [2/3] Docker Desktop 확인 중...
docker --version >nul 2>&1
if errorlevel 1 (
    echo     ✗ Docker Desktop이 설치되지 않았습니다.
    echo.
    echo     [설치 필요]
    echo     1. https://www.docker.com/products/docker-desktop
    echo     2. Docker Desktop 다운로드 및 설치
    echo     3. 재부팅
    echo     4. 이 스크립트 다시 실행
    echo.
    pause
    exit /b 1
)
echo     ✓ Docker Desktop 설치됨
echo.

echo [3/3] 설치 정보 기록 중...
echo 설치 일시: %date% %time% > "%LOCAL_PATH%\설치_정보.txt"
echo 설치자: %USERNAME% >> "%LOCAL_PATH%\설치_정보.txt"
echo 컴퓨터: %COMPUTERNAME% >> "%LOCAL_PATH%\설치_정보.txt"
echo 원본: %NETWORK_PATH% >> "%LOCAL_PATH%\설치_정보.txt"
echo ✓ 완료
echo.

echo ============================================================
echo    ✓ 설치 완료!
echo ============================================================
echo.
echo [실행 방법]
echo    %LOCAL_PATH%\START_DOCKER.bat 더블클릭
echo.
echo [자동 실행]
choice /c YN /m "지금 HMI 시스템을 실행하시겠습니까? (Y/N)"
if errorlevel 2 goto :end
if errorlevel 1 (
    echo.
    echo HMI 시스템을 시작합니다...
    cd /d "%LOCAL_PATH%"
    call START_DOCKER.bat
)
goto :end

:cancel
echo.
echo 설치가 취소되었습니다.
pause
exit /b 0

:end
pause
```

---

## 4단계: 실전 운영

### 개발자 워크플로우

```
1. 로컬에서 개발
   C:\HMI_REAL\

2. 테스트 완료 후 배포
   DEPLOY_TO_NETWORK.bat 실행

3. 사용자에게 알림
   "최신 버전이 배포되었습니다"
```

### 사용자 워크플로우

```
초기 설치:
1. \\192.168.0.250\HMI_배포\ 접속
2. INSTALL_FROM_NETWORK.bat 실행
3. 자동 설치
4. 완료

업데이트:
1. INSTALL_FROM_NETWORK.bat 다시 실행
2. Y (덮어쓰기 확인)
3. 자동 업데이트
4. 완료

일상 사용:
1. C:\HMI_REAL\START_DOCKER.bat 실행
2. 작업
3. STOP_DOCKER.bat 종료
```

---

## 5단계: 버전 관리

### 버전별 폴더 명명 규칙

```
\\192.168.0.250\HMI_배포\01_이전버전\
├── HMI_REAL_20250118_1430  (날짜_시간)
├── HMI_REAL_20250111_0920
├── HMI_REAL_v1.2.0          (버전 번호)
├── HMI_REAL_v1.1.0
└── HMI_REAL_긴급수정_20250115
```

### 변경 이력 관리

**CHANGELOG.txt:** (네트워크 배포 폴더에)
```
# HMI 시스템 변경 이력

## 2025-01-18
- Docker 지원 추가
- 배포 방식 개선
- 자동 설치 스크립트 추가

## 2025-01-11
- 알람 기능 수정
- 펌프 심볼 개선
- 운전 이력 추가

## 2025-01-04
- 초기 버전 배포
```

---

## 장점 및 단점

### ✅ 장점

```
1. 중앙 집중식 관리
   - 한 곳에서 배포
   - 버전 통제 용이
   - 백업 자동화

2. 사용자 편의성
   - 간단한 설치 (스크립트 실행)
   - 자동 업데이트
   - 로컬 실행으로 빠름

3. 문제 해결
   - 보안 경고 최소화
   - Docker 정상 작동
   - 성능 최적화
```

### ⚠️ 단점

```
1. 초기 복사 필요
   - 각 PC에 10~50MB 복사 (1~2분)
   - 디스크 공간 사용

2. 동기화 수동
   - 업데이트 시 수동 실행 필요
   - 자동 동기화 아님
```

---

## 대안: Git 사용 (고급)

개발팀이 Git에 익숙하다면:

```
1. Git 저장소 설정
   \\192.168.0.250\git\hmi-real.git

2. 개발자
   git commit → git push

3. 사용자
   git pull → START_DOCKER.bat

장점:
- 자동 버전 관리
- 변경 이력 추적
- 브랜치 지원
```

---

## 최종 권장 방식

### 🌟 **베스트 프랙티스**

```
네트워크 역할:
📦 배포 저장소 (읽기 전용)

각 PC 역할:
💻 실행 환경 (로컬)

워크플로우:
1. 개발 → 네트워크 배포
2. 네트워크 → 로컬 복사
3. 로컬 → 실행/사용
```

### 📋 **실행 계획**

```
Step 1: 네트워크 폴더 구조 생성
  \\192.168.0.250\HMI_배포\
  ├── 00_최신버전\
  ├── 01_이전버전\
  └── 스크립트들\

Step 2: 배포 스크립트 생성
  - DEPLOY_TO_NETWORK.bat
  - INSTALL_FROM_NETWORK.bat

Step 3: 문서 작성
  - 설치_가이드.txt
  - 사용자_매뉴얼.pdf

Step 4: 사용자 교육
  - 설치 방법
  - 업데이트 방법
  - 문제 해결
```

---

**작성일:** 2025-01-18
**문서 버전:** 1.0
