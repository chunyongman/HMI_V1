services:
  # PLC 시뮬레이터
  plc-simulator:
    build:
      context: ./simulator
      dockerfile: Dockerfile
    container_name: hmi-plc-simulator
    ports:
      - "502:502"
    volumes:
      # 소스 코드 실시간 동기화 (개발용)
      - ./simulator:/app
    networks:
      - hmi-network
    restart: unless-stopped
    environment:
      - PYTHONUNBUFFERED=1

  # 백엔드 서버
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: hmi-backend
    ports:
      - "8000:8000"
    volumes:
      # 소스 코드 실시간 동기화 (개발용)
      - ./backend:/app
      # 데이터 영속화
      - ./backend/data:/app/data
    environment:
      - PYTHONUNBUFFERED=1
      - PLC_HOST=plc-simulator
      - PLC_PORT=502
    depends_on:
      - plc-simulator
    networks:
      - hmi-network
    restart: unless-stopped

  # 프론트엔드
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: hmi-frontend
    ports:
      - "5173:5173"
    volumes:
      # 소스 코드 실시간 동기화 (개발용)
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public
      - ./frontend/index.html:/app/index.html
      - ./frontend/vite.config.js:/app/vite.config.js
      # node_modules는 컨테이너 내부 것 사용 (성능 최적화)
      - /app/node_modules
    environment:
      - VITE_API_URL=http://localhost:8000
    depends_on:
      - backend
    networks:
      - hmi-network
    restart: unless-stopped

networks:
  hmi-network:
    driver: bridge
