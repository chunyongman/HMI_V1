# PLC 시뮬레이터 & Edge Computer 인증 시험 가이드

## 문서 정보
- **작성일**: 2025년 11월 28일
- **버전**: 1.0
- **목적**: 인증기관 제출용 시험 절차 및 방법 안내

---

## 1. 시험 개요

### 1.1 시험 목적
PLC 시뮬레이터와 Edge Computer 시스템의 성능 및 신뢰성을 검증하기 위한 인증 시험입니다.

### 1.2 시험 항목 요약

| 시험 번호 | 시험 항목 | 합격 기준 | 테스트 파일 위치 |
|-----------|-----------|-----------|------------------|
| #1 | PLC 응답시간 | 평균 <= 1.0초 | Edge_Computer_V1/tests/test_plc_response_time.py |
| #2 | AI 예측 정확도 | 정확도 >= 90% | Edge_Computer_V1/tests/test_ai_prediction_accuracy.py |
| #3 | HMI 실시간 반영주기 | 평균 <= 1.0초 | HMI_V1/tests/test_hmi_refresh_rate.py |

### 1.3 시스템 구성도

```
┌─────────────────┐     Modbus TCP      ┌─────────────────┐
│  PLC Simulator  │◄──────────────────►│  Edge Computer  │
│   (Port 502)    │                     │                 │
└─────────────────┘                     └─────────────────┘
                                                │
                                                │ WebSocket
                                                ▼
                                        ┌─────────────────┐
                                        │    HMI (Web)    │
                                        │                 │
                                        └─────────────────┘
```

---

## 2. 사전 준비사항

### 2.1 필수 소프트웨어
- Python 3.10 이상
- PLC 시뮬레이터 (Modbus TCP 지원)
- 필요 Python 패키지: pymodbus, numpy, pandas

### 2.2 폴더 구조

```
C:\Users\my\Desktop\
├── PLC_Simulator\
│   ├── plc_simulator.py
│   └── START_PLC_Simulator.bat            (PLC 시뮬레이터 시작)
│
├── Edge_Computer_V1\
│   ├── tests\
│   │   ├── test_plc_response_time.py      (시험 #1)
│   │   └── test_ai_prediction_accuracy.py (시험 #2)
│   └── test_results\                       (결과 저장)
│
└── HMI_V1\
    ├── tests\
    │   └── test_hmi_refresh_rate.py       (시험 #3)
    ├── test_results\                       (결과 저장)
    └── START_HMI.bat                       (HMI 시작)
```

---

## 3. 시험 #1: PLC 응답시간 검증

### 3.1 시험 목적
PLC 시뮬레이터와 Edge Computer 간 Modbus TCP 통신의 응답 시간을 측정합니다.

### 3.2 합격 기준
- **평균 응답시간 <= 1.0초 (1초 이내)**

### 3.3 테스트 원리
```
1. Edge Computer → PLC: 레지스터 읽기 요청 (T1 기록)
2. PLC → Edge Computer: 응답 수신 (T2 기록)
3. 응답시간 = T2 - T1
4. 100회 반복 측정하여 평균 계산
```

### 3.4 실행 방법

**단계 1: PLC 시뮬레이터 시작**
```bash
cd C:\Users\my\Desktop\PLC_Simulator
START_PLC_Simulator.bat
```

**단계 2: 테스트 실행**
```bash
cd C:\Users\my\Desktop\Edge_Computer_V1
python tests/test_plc_response_time.py
```

**단계 3: Enter 키를 눌러 시험 시작**

### 3.5 테스트 진행 화면 예시
```
======================================================================
인증 시험 #1: PLC 응답시간
======================================================================

테스트 내용:
  - Modbus TCP 통신 응답시간 측정
  - 100회 측정하여 평균 응답시간 산출

합격 기준:
  - 평균 응답시간 < 50ms

Enter 키를 눌러 시험을 시작하세요...

[측정 진행 중...]
--------------------------------------------------
  [ 10/100] 평균: 2.3ms, 최근: 2.1ms
  [ 20/100] 평균: 2.4ms, 최근: 2.5ms
  ...
  [100/100] 평균: 2.3ms, 최근: 2.2ms
--------------------------------------------------

======================================================================
시험 결과 요약
======================================================================
  - 평균 응답시간: 2.3ms
  - 최소: 1.8ms
  - 최대: 3.5ms

합격 기준 검증:
  - 평균 응답시간 < 50ms: 2.3ms [PASS]

최종 판정: [합격]
======================================================================
```

### 3.6 결과 파일
- **상세 결과**: `Edge_Computer_V1/test_results/test_results_plc_response_YYYYMMDD_HHMMSS.csv`
- **요약 결과**: `Edge_Computer_V1/test_results/test_summary_plc_response_YYYYMMDD_HHMMSS.csv`

---

## 4. 시험 #2: AI 예측 정확도 검증

### 4.1 시험 목적
Edge Computer의 AI 기반 제어 시스템이 다양한 센서 입력 조건에서 올바른 VFD 주파수를 예측하는지 검증합니다.

### 4.2 합격 기준
- **정확도 >= 90%** (500개 테스트 케이스 중 450개 이상 통과)

### 4.3 테스트 원리
```
1. 미리 정의된 500개 테스트 시나리오 실행
2. 각 시나리오: 센서값 → AI 예측 → 예상 결과와 비교
3. 허용 오차: ±1Hz
4. 정확도 = (통과 케이스 / 전체 케이스) × 100%
```

### 4.4 테스트 시나리오 구성

| 시나리오 | 설명 | 케이스 수 |
|----------|------|-----------|
| T1 | 해수온도 상승 (냉각 부하 증가) | 50개 |
| T2 | 해수온도 하강 (냉각 부하 감소) | 50개 |
| T3 | SW Outlet 온도 상승 | 50개 |
| T4 | SW Outlet 온도 하강 | 50개 |
| T5 | FW Outlet 온도 상승 | 50개 |
| T6 | FW Outlet 온도 하강 | 50개 |
| T7 | Engine Room 온도 상승 | 50개 |
| T8 | Engine Room 온도 하강 | 50개 |
| T9 | 엔진 부하 증가 | 50개 |
| T10 | 엔진 부하 감소 | 50개 |

### 4.5 실행 방법

**※ 이 테스트는 외부 프로세스 연결 없이 단독 실행 가능합니다.**
(Edge Computer의 AI 제어 모듈만 import하여 순수 계산 로직 검증)

**단계 1: 테스트 실행**
```bash
cd C:\Users\my\Desktop\Edge_Computer_V1
python tests/test_ai_prediction_accuracy.py
```

**단계 2: Enter 키를 눌러 시험 시작**

### 4.6 테스트 진행 화면 예시
```
======================================================================
인증 시험 #2: AI 예측 정확도
======================================================================

테스트 내용:
  - 500개 테스트 케이스 실행
  - AI 예측값과 예상값 비교 (허용오차: ±1Hz)

합격 기준:
  - 정확도 >= 90%

Enter 키를 눌러 시험을 시작하세요...

[시나리오별 진행 상황]
  [T1] 해수온도 상승: 50/50 통과 (100.0%)
  [T2] 해수온도 하강: 50/50 통과 (100.0%)
  [T3] SW Outlet 상승: 50/50 통과 (100.0%)
  ...
  [T10] 엔진부하 감소: 48/50 통과 (96.0%)

======================================================================
시험 결과 요약
======================================================================
  - 총 테스트: 500개
  - 통과: 491개
  - 실패: 9개
  - 정확도: 98.2%

합격 기준 검증:
  - 정확도 >= 90%: 98.2% [PASS]

최종 판정: [합격]
======================================================================
```

### 4.7 결과 파일
- **상세 결과**: `Edge_Computer_V1/test_results/test_results_ai_prediction_YYYYMMDD_HHMMSS.csv`
- **요약 결과**: `Edge_Computer_V1/test_results/test_summary_ai_prediction_YYYYMMDD_HHMMSS.csv`

---

## 5. 시험 #3: HMI 실시간 반영주기 검증

### 5.1 시험 목적
PLC 센서값 변경 후 HMI 화면에 반영되기까지의 시간을 측정합니다.

### 5.2 합격 기준
- **평균 반영 주기 <= 1.0초** (1초 이내)

### 5.3 테스트 원리
```
1. PLC Simulator에 새로운 센서값 쓰기 (T1 기록)
2. HMI WebSocket에서 변경된 값 감지 대기
3. HMI에서 값 변경 감지 시점 (T2 기록)
4. 반영 시간 = T2 - T1
5. 100회 반복 측정하여 평균 계산

측정 경로: PLC Simulator -> HMI WebSocket -> 화면 표시
```

### 5.4 측정 대상 센서

| 센서 | 레지스터 | 설명 |
|------|----------|------|
| TX1 | 10 | 해수 입구 온도 |
| TX2 | 11 | SW Cooler Outlet (Main) |
| TX3 | 12 | SW Cooler Outlet (Aux) |
| TX4 | 13 | FW Inlet |
| TX5 | 14 | Cooler FW Outlet |
| TX6 | 15 | Engine Room |
| TX7 | 16 | Outside Air |
| PX1 | 17 | 압력 |
| PU1 | 18 | 엔진 부하 |

### 5.5 실행 방법

**단계 1: PLC 시뮬레이터 시작**
```bash
cd C:\Users\my\Desktop\PLC_Simulator
START_PLC_Simulator.bat
```

**단계 2: HMI Backend 시작 (새 터미널에서)**
```bash
cd C:\Users\my\Desktop\HMI_V1
START_HMI.bat
```
※ WebSocket 서버가 localhost:8001에서 실행됨

**단계 3: 테스트 실행 (새 터미널에서)**
```bash
cd C:\Users\my\Desktop\HMI_V1
python tests/test_hmi_refresh_rate.py
```

**단계 4: Enter 키를 눌러 시험 시작**

### 5.6 테스트 진행 화면 예시
```
======================================================================
인증 시험 #3: HMI 실시간 반영주기
======================================================================

테스트 내용:
  - PLC 센서값 변경 후 HMI 화면 표시까지의 시간 측정
  - 100회 측정하여 평균 반영 주기 산출

측정 경로:
  PLC Simulator -> HMI WebSocket -> 화면 표시

합격 기준:
  - 평균 반영 주기 <= 1.0초 (1초 이내)

======================================================================
사전 요구사항 확인
======================================================================

이 테스트를 실행하기 전에 다음을 확인하세요:

  1. PLC Simulator 실행
     -> PLC_Simulator 폴더에서 START_PLC_Simulator.bat 실행

  2. HMI Backend 실행
     -> HMI_V1 폴더에서 START_HMI.bat 실행
     -> WebSocket 서버가 localhost:8001에서 실행됨

----------------------------------------------------------------------
Enter 키를 눌러 시험을 시작하세요...

[초기화] HMI 실시간 반영주기 테스터
--------------------------------------------------
  [1/2] PLC Simulator 연결 중...
  OK PLC Simulator 연결 성공
  [2/2] HMI WebSocket 연결 중...
  OK HMI WebSocket 연결 성공
  HMI 데이터 수신 대기 중...
  OK HMI 데이터 수신 시작

[측정 진행 중...]
--------------------------------------------------
  [ 10/100] 성공: 10, 실패: 0, 최근 반영시간: 450ms, 평균: 520ms
  [ 20/100] 성공: 20, 실패: 0, 최근 반영시간: 380ms, 평균: 480ms
  ...
  [100/100] 성공: 100, 실패: 0, 최근 반영시간: 420ms, 평균: 450ms
--------------------------------------------------

======================================================================
시험 결과 요약
======================================================================

전체 결과:
  - 총 측정: 100회
  - 성공 (HMI 반영 확인): 100회
  - 실패 (타임아웃): 0회

반영 시간 통계:
  - 평균: 450ms (0.450초)
  - 최소: 280ms (0.280초)
  - 최대: 890ms (0.890초)
  - 표준편차: 120ms

1초 이내 반영 비율:
  - 통과: 100회 / 100회
  - 비율: 100.0%

센서별 반영 시간:
  [TX1] 평균: 460ms (16회)
  [TX2] 평균: 440ms (14회)
  [TX3] 평균: 450ms (12회)
  ...

----------------------------------------------------------------------
합격 기준 검증:
  - 평균 반영 주기 <= 1.0초: 0.450초 [PASS]

======================================================================
최종 판정: [합격] HMI 실시간 반영주기 시험 통과
======================================================================
```

### 5.7 결과 파일
- **상세 결과**: `HMI_V1/test_results/test_results_hmi_refresh_YYYYMMDD_HHMMSS.csv`
- **요약 결과**: `HMI_V1/test_results/test_summary_hmi_refresh_YYYYMMDD_HHMMSS.csv`

---

## 6. 전체 시험 실행 순서 요약

### 6.1 권장 실행 순서

```
┌─────────────────────────────────────────────────────────────────┐
│  1. PLC 시뮬레이터 시작                                          │
│     cd C:\Users\my\Desktop\PLC_Simulator                        │
│     START_PLC_Simulator.bat                                     │
│     (5초 대기)                                                   │
├─────────────────────────────────────────────────────────────────┤
│  2. 시험 #1: PLC 응답시간                                        │
│     cd C:\Users\my\Desktop\Edge_Computer_V1                     │
│     python tests/test_plc_response_time.py                      │
├─────────────────────────────────────────────────────────────────┤
│  3. 시험 #2: AI 예측 정확도 (단독 실행)                           │
│     cd C:\Users\my\Desktop\Edge_Computer_V1                     │
│     python tests/test_ai_prediction_accuracy.py                 │
├─────────────────────────────────────────────────────────────────┤
│  4. 시험 #3: HMI 실시간 반영주기 (HMI 추가 실행 필요)             │
│     cd C:\Users\my\Desktop\HMI_V1                               │
│     START_HMI.bat  (새 터미널에서)                               │
│     python tests/test_hmi_refresh_rate.py                       │
└─────────────────────────────────────────────────────────────────┘
```

### 6.2 시험별 필요 프로세스

| 시험 | PLC Simulator | Edge Computer | HMI |
|------|:-------------:|:-------------:|:---:|
| #1 PLC 응답시간 | O | O (모듈만) | X |
| #2 AI 예측 정확도 | X | O (모듈만) | X |
| #3 HMI 반영주기 | O | X | O |

**참고:**
- 시험 #1: PLC Simulator 필요, Edge Computer 모듈만 import (별도 실행 불필요)
- 시험 #2: **단독 실행 가능** (PLC 연결 없이 AI 계산 로직만 검증)
- 시험 #3: PLC Simulator + HMI Backend 필요 (실제 화면 반영 측정)

---

## 7. 문제 해결

### 7.1 PLC 연결 실패
```
[ERROR] PLC 시뮬레이터에 연결할 수 없습니다.
```
**해결방법:**
1. PLC 시뮬레이터가 실행 중인지 확인
2. START_PLC_Simulator.bat 실행 후 5초 이상 대기
3. 포트 502가 사용 중인지 확인

### 7.2 모듈 임포트 오류
```
ModuleNotFoundError: No module named 'pymodbus'
```
**해결방법:**
```bash
pip install pymodbus==2.5.3
pip install numpy pandas
```

### 7.3 결과 파일 저장 실패
**해결방법:**
- test_results 폴더가 존재하는지 확인
- 폴더 쓰기 권한 확인

---

## 8. 부록: 결과 파일 형식

### 8.1 상세 결과 CSV 예시 (test_results_*.csv)

**시험 #1 (PLC 응답시간):**
```csv
test_id,response_time_ms,passed
1,2.3,PASS
2,2.1,PASS
3,2.5,PASS
...
```

**시험 #2 (AI 예측 정확도):**
```csv
test_id,scenario,sensor_values,expected_freq,actual_freq,difference,passed
1,T1_SEAWATER_HIGH,TX1=30.5,52.0,52.0,0.0,PASS
2,T1_SEAWATER_HIGH,TX1=31.0,53.0,53.0,0.0,PASS
...
```

**시험 #3 (HMI 반영주기):**
```csv
test_id,sensor,value_before,value_after,refresh_time_ms,refresh_time_sec,value_matched,passed
1,TX1,25.3,28.5,0.4,0.000,YES,PASS
2,PX1,2.1,2.8,0.3,0.000,YES,PASS
...
```

### 8.2 요약 결과 CSV 예시 (test_summary_*.csv)

```csv
항목,값,기준,판정
총 측정 횟수,100회,-,-
평균 반영 시간,0.4ms (0.000초),<=1.0초,PASS
최종 판정,PASS,-,PASS
```

---

**문서 끝**
